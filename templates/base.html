{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}VigilPay{% endblock %}</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            red:   { DEFAULT: "#8C1515", dark: "#6A0F0F", muted: "#F5E6E6" },
            navy:  { DEFAULT: "#252422", dark: "#1a1917", mid: "#2e2b28" },
            gold:  { DEFAULT: "#C9A84C", light: "#E8C97A" },
            stone: { DEFAULT: "#F6F4F1", mid: "#E8E3DC", deep: "#C4BBB0" },
          },
          fontFamily: {
            sans:    ["Poppins", "system-ui", "sans-serif"],
            display: ["Playfair Display", "Georgia", "serif"],
          },
        },
      },
    };
  </script>

  <link rel="stylesheet" href="{% static 'styles/app.css' %}" />

  {% block extra_head %}{% endblock %}
</head>
<body>

<!-- Mobile overlay -->
<div id="mobileOverlay"></div>

<!-- -------------------------------------------
     SIDEBAR
------------------------------------------- -->
<aside id="sidebar">
  <div class="relative z-10 flex flex-col h-full">

    <!-- Logo -->
    <div class="flex items-center justify-between px-4 border-b border-white/[0.07] flex-shrink-0" style="height:var(--topbar-h)">
      <a href="/" class="flex items-center gap-2.5 min-w-0">
        <div style="width:32px;height:32px;background:var(--red);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 0 16px var(--red-glow)">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
            <path d="M10 2.5L16.5 6v8L10 17.5 3.5 14V6L10 2.5z" stroke="white" stroke-width="1.7" fill="none" stroke-linejoin="round"/>
            <circle cx="10" cy="10" r="2.4" fill="white"/>
          </svg>
        </div>
        <span class="nav-text font-bold text-white" style="font-size:1rem;letter-spacing:-0.02em;transition:opacity 0.2s">
          Vigil<span style="color:var(--red)">Pay</span>
        </span>
      </a>

      <!-- Desktop collapse toggle -->
      <button id="toggleSidebar" class="toggle-btn hidden lg:flex ml-2 flex-shrink-0">
        <svg id="toggleIcon" width="14" height="14" viewBox="0 0 14 14" fill="none" style="transition:transform 0.3s">
          <path d="M9 2L4 7l5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Mobile close -->
      <button id="closeSidebar" class="lg:hidden toggle-btn ml-2">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M2 2l10 10M12 2L2 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 overflow-y-auto overflow-x-hidden px-3 py-5">

      <ul class="space-y-0.5">

        <!-- Dashboard -->
        <li class="nav-item">
          <a href="{% url 'dashboard_page' %}" data-navkey="dashboard">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 15a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4zM14 13a1 1 0 011-1h4a1 1 0 011 1v6a1 1 0 01-1 1h-4a1 1 0 01-1-1v-6z"/></svg>
            <span class="nav-text">Dashboard</span>
            <span class="tooltip">Dashboard</span>
          </a>
        </li>

        <!-- Risk Level -->
        <li class="nav-item">
          <a href="{% url 'risk_level_page' %}" data-navkey="risk">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg>
            <span class="nav-text">Risk Level</span>
            <span class="tooltip">Risk Level</span>
          </a>
        </li>

        <!-- Data Management -->
        <li class="nav-item">
          <a href="{% url 'data_management_page' %}" data-navkey="data">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/></svg>
            <span class="nav-text">Data Management</span>
            <span class="tooltip">Data Management</span>
          </a>
        </li>

        <!-- Engagement Hub -->
        <li class="nav-item">
          <a href="{% url 'engagement_hub_page' %}" data-navkey="engagement-hub">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M3 7h18M3 12h18M3 17h18"/></svg>
            <span class="nav-text">Engagement Hub</span>
            <span class="tooltip">Engagement Hub</span>
          </a>
        </li>

        <!-- Model Insight -->
        <li class="nav-item">
          <a href="{% url 'model_insight_page' %}" data-navkey="insight">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            <span class="nav-text">Model Insight</span>
            <span class="tooltip">Model Insight</span>
          </a>
        </li>

        <!-- Profile -->
        <li class="nav-item">
          <a href="{% url 'profile_page' %}" data-navkey="profile">
            <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            <span class="nav-text">Profile</span>
            <span class="tooltip">Profile</span>
          </a>
        </li>

      </ul>

    </nav>

    <!-- User footer -->
    <div class="flex-shrink-0 border-t border-white/[0.07] px-3 py-4">
      <div class="flex items-center gap-3" style="min-width:0">
        <div style="width:34px;height:34px;background:linear-gradient(135deg,var(--red) 0%,var(--red-dark) 100%);border-radius:9px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.72rem;color:#fff;flex-shrink:0">
          {% if user.is_authenticated %}{{ user.first_name.0|default:user.username.0|upper }}{% else %}G{% endif %}
        </div>
        <div id="sidebarFooterText" style="min-width:0;flex:1;overflow:hidden;white-space:nowrap;transition:width 0.3s,opacity 0.2s">
          <p style="font-size:0.78rem;font-weight:700;color:rgba(255,255,255,0.85);overflow:hidden;text-overflow:ellipsis">
            {% if user.is_authenticated %}{{ user.get_full_name|default:user.username }}{% else %}Guest{% endif %}
          </p>
          <p style="font-size:0.65rem;color:rgba(255,255,255,0.35)">Administrator</p>
        </div>
        {% if user.is_authenticated %}
        <form method="post" action="{% url 'logout_page' %}" style="margin:0">
          {% csrf_token %}
          <button id="sidebarFooterLogout" type="submit" class="toggle-btn flex-shrink-0" title="Logout" style="color:rgba(255,255,255,0.4);transition:width 0.3s,opacity 0.2s;background:none;border:none;cursor:pointer">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" stroke="currentColor"/></svg>
          </button>
        </form>
        {% endif %}
      </div>
    </div>

  </div>
</aside>

<!-- -------------------------------------------
     MAIN CONTENT WRAPPER
------------------------------------------- -->
<div id="mainContent">

  <!-- Top Bar -->
  <header id="topbar">
    <div class="flex items-center justify-between px-5 lg:px-7 gap-4" style="height:var(--topbar-h)">

      <!-- Left -->
      <div class="flex items-center gap-3 flex-1 min-w-0">
        <!-- Mobile menu button -->
        <button id="openSidebar" class="hbtn lg:hidden flex-shrink-0">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>

        <!-- Page title -->
        <div class="min-w-0">
          <h1 style="font-family:'Playfair Display',serif;font-weight:900;font-size:clamp(1.05rem,2vw,1.35rem);color:var(--navy);letter-spacing:-0.02em;line-height:1.15;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">
            {% block page_title %}Dashboard{% endblock %}
          </h1>
          <p style="font-size:0.7rem;color:#aaa;font-weight:500;margin-top:1px">{% now "l, F j, Y" %}</p>
        </div>
      </div>

      <!-- Right -->
      <div class="flex items-center gap-1.5 flex-shrink-0">

        <!-- Search â€” hidden on mobile -->
        <div class="relative hidden md:block" id="globalSearchWrap">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#bbb;pointer-events:none"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          <input
            id="globalSearchInput"
            type="text"
            placeholder="Search customer, geography, ID..."
            class="search-input"
            style="padding:7px 14px 7px 32px;width:260px"
            data-search-url="{% url 'dashboard_search' %}"
          />
          <div id="globalSearchResults" class="search-results hidden"></div>
        </div>

        <!-- Notifications -->
        <button class="hbtn relative">
          <svg width="17" height="17" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
          <span class="notif-dot pulse-dot"></span>
        </button>

        <!-- Divider -->
        <div style="width:1px;height:24px;background:var(--stone-mid);margin:0 4px"></div>

        <!-- User -->
        <div class="relative">
          <button id="userMenuButton" style="display:flex;align-items:center;gap:8px;background:none;border:none;cursor:pointer;padding:4px">
            <div class="user-avatar">
              {% if user.is_authenticated %}{{ user.first_name.0|default:user.username.0|upper }}{% else %}G{% endif %}
            </div>
            <div class="hidden lg:block text-left" style="min-width:0">
              <p style="font-size:0.78rem;font-weight:700;color:var(--navy);white-space:nowrap">
                {% if user.is_authenticated %}{{ user.first_name|default:user.username }}{% else %}Guest{% endif %}
              </p>
              <p style="font-size:0.65rem;color:#aaa;white-space:nowrap">Administrator</p>
            </div>
            <svg class="hidden lg:block" width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color:#bbb;flex-shrink:0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </button>

          <!-- Dropdown -->
          <div id="userDropdown" class="hidden">
            {% if user.is_authenticated %}
            <div style="padding:12px 16px;border-bottom:1px solid var(--stone-mid)">
              <p style="font-size:0.8rem;font-weight:700;color:var(--navy)">{{ user.get_full_name|default:user.username }}</p>
              <p style="font-size:0.7rem;color:#aaa;margin-top:2px">{{ user.email|default:"No email" }}</p>
            </div>
            <a href="#" class="dropdown-item">
              <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              Profile Settings
            </a>
            <a href="#" class="dropdown-item">
              <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
              Preferences
            </a>
            <div class="dropdown-divider"></div>
            <form method="post" action="{% url 'logout_page' %}" style="margin:0">
              {% csrf_token %}
              <button type="submit" class="dropdown-item danger" style="width:100%;text-align:left;background:none;border:none;cursor:pointer">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                Logout
              </button>
            </form>
            {% else %}
            <a href="{% url 'login_page' %}" class="dropdown-item">
              <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/></svg>
              Login
            </a>
            {% endif %}
          </div>
        </div>

      </div>
    </div>
  </header>

  <!-- Page Content -->
  <main>
    {% if messages %}
    <div style="margin-bottom:1.5rem">
      {% for message in messages %}
      <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'success' %}alert-success{% else %}alert-info{% endif %}">
        <svg width="15" height="15" fill="currentColor" viewBox="0 0 20 20" style="flex-shrink:0;margin-top:1px">
          {% if message.tags == 'error' %}<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
          {% elif message.tags == 'success' %}<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          {% else %}<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>{% endif %}
        </svg>
        <span>{{ message }}</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

</div>

<!-- -------------------------------------------
     SCRIPTS
------------------------------------------- -->
<script src="{% static 'scripts/app.js' %}"></script>

{% block extra_js %}{% endblock %}
</body>
</html>



